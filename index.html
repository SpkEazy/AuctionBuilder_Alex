<!DOCTYPE html>
<html>
<head>
  <title>AuctionInc Generator</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/docx@8.3.0/build/index.umd.js"></script>

  <style>
    .preview-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-top: 20px;
// =====================
// CONFIG (Manual controls)
// =====================

// ✅ Nudge the SOCIAL top-right red tag (in "design pixels" based on 1130-wide photo canvas system)
const SOCIAL_RED_TAG_NUDGE_X = 60; // + right, - left (try 40–120)
const SOCIAL_RED_TAG_NUDGE_Y = 0;  // + down, - up

// Optional: if you want the tag slightly more/less transparent
const SOCIAL_RED_TAG_ALPHA = 0.96;

// ✅ Broker directory convention (optional):
// assets/brokers/<brokerId>/broker-photo.png
// assets/brokers/<brokerId>/broker-phone.png
const BROKERS = {
  "alex-krause": { name: "Alex Krause", phone: "078 549 2029", email: "alex@auctioninc.co.za" },
  "gary-brower": { name: "Gary Brower", phone: "082 352 5552", email: "garyb@auctioninc.co.za" },
  "bongane-khumalo": { name: "Bongane Khumalo", phone: "073 785 5100", email: "bongane@auctioninc.co.za" },
  "cliff-matshatsha": { name: "Cliff Matshatsha", phone: "082 099 8692", email: "cliff@auctioninc.co.za" },
  "daniel-wachenheimer": { name: "Daniel Wachenheimer", phone: "082 740 2856", email: "daniel@auctioninc.co.za" },
  "dean-doucha": { name: "Dean Doucha", phone: "082 374 5565", email: "dean@auctioninc.co.za" },
  "elki-medalie": { name: "Elki Medalie", phone: "083 764 5370", email: "elki@auctioninc.co.za" },
  "doron-sacks": { name: "Doron Sacks", phone: "082 550 7081", email: "doron@auctioninc.co.za" },
  "george-merricks": { name: "George Merricks", phone: "082 859 9303", email: "george@auctioninc.co.za" },
  "gerhard-venter": { name: "Gerhard Venter", phone: "076 905 5519", email: "gerhard@auctioninc.co.za" },
  "jenny-pillay": { name: "Jenny Pillay", phone: "063 959 2260", email: "jenny@auctioninc.co.za" },
  "jessica-beyers-lahner": { name: "Jessica Beyers-Lahner", phone: "072 576 0973", email: "jessica@auctioninc.co.za" },
  "jodi-bedil": { name: "Jodi Bedil", phone: "076 637 1273", email: "jodib@auctioninc.co.za" },
  "jodi-frankel": { name: "Jodi Frankel", phone: "082 441 8409", email: "jodif@auctioninc.co.za" },
  "keith-nkosi": { name: "Keith Nkosi", phone: "081 828 1817", email: "keith@auctioninc.co.za" },
  "luanda-tlhotlhalemaje": { name: "Luanda Tlhotlhalemaje", phone: "071 904 4061", email: "luanda@skyriseproperties.co.za" },
  "nic-brett": { name: "Nic Brett", phone: "078 330 7523", email: "nic@auctioninc.co.za" },
  "reece-louw": { name: "Reece Louw", phone: "076 393 1131", email: "reece@auctioninc.co.za" },
  "reshma-sookran": { name: "Reshma Sookran", phone: "071 876 6524", email: "reshma@auctioninc.co.za" },
  "shlomo-hecht": { name: "Shlomo Hecht", phone: "073 791 7967", email: "shlomo@auctioninc.co.za" },
  "sim-mthembu": { name: "Sim Mthembu", phone: "063 829 7431", email: "simphiwe@auctioninc.co.za" },
  "stuart-holliman": { name: "Stuart Holliman", phone: "067 373 9239", email: "stuart@auctioninc.co.za" },
  "thabani-ncube": { name: "Thabani Ncube", phone: "071 624 2899", email: "thabani@auctioninc.co.za" },
  "yoni-dadon": { name: "Yoni Dadon", phone: "061 822 6128", email: "yoni@auctioninc.co.za" }
};

// =====================
// Helpers
// =====================
function formatDate(dateString, timeString) {
  if (!dateString || !timeString) return '';
  const date = new Date(`${dateString}T${timeString}`);
  const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
  return `${date.toLocaleDateString('en-ZA', options)} @ ${timeString}`;
}

async function waitForElement(selector, root = document, timeout = 3000) {
  const start = Date.now();
  while (!root.querySelector(selector)) {
    await new Promise(r => requestAnimationFrame(r));
    if (Date.now() - start > timeout) return null;
  }
  return root.querySelector(selector);
}

function waitForImagesToLoad(container) {
  const images = container.querySelectorAll('img');
  const promises = Array.from(images).map(img =>
    new Promise(resolve => {
      if (img.complete) return resolve();
      img.onload = img.onerror = resolve;
    })
  );
  return Promise.all(promises);
}

function waitForRenderFrames(frames = 3) {
  return new Promise(resolve => {
    const step = () => {
      if (frames-- <= 0) resolve();
      else requestAnimationFrame(step);
    };
    requestAnimationFrame(step);
  });
}

// ✅ Always builds correct URL for GitHub Pages + local
function absUrl(relativePath) {
  return new URL(relativePath, window.location.href).toString();
}

// =====================
// Broker helpers
// =====================
function getSelectedBroker() {
  const brokerId = document.getElementById("broker")?.value || "alex-krause";
  const broker = BROKERS[brokerId] || BROKERS["alex-krause"];
  return { brokerId, broker };
}

function setImgWithFallback(imgEl, primarySrc, fallbackSrc) {
  if (!imgEl) return;
  imgEl.onerror = () => {
    imgEl.onerror = null;
    imgEl.src = fallbackSrc;
  };
  imgEl.src = primarySrc;
}

function applyBrokerToTemplate(target, templatePath, brokerId, broker) {
  if (templatePath.includes("newsletter")) {
    const contact = target.querySelector(".textbox_Contact_Details");
    if (contact) {
      contact.innerHTML = `
        <span>${(broker.name || "").toUpperCase()}</span>
        <span>${broker.phone || ""}</span>
        <span>${broker.email || ""}</span>
      `;
    }
    .preview-box {
      background: #f4f4f4;
      border: 2px solid #ccc;
      padding: 10px;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
      overflow: auto;

    const brokerPhoto = target.querySelector(".overlay-image_Broker_Photo");
    setImgWithFallback(
      brokerPhoto,
      absUrl(`assets/brokers/${brokerId}/broker-photo.png`),
      absUrl("assets/broker-photo.png")
    );
  }

  if (templatePath.includes("flyer")) {
    const brokerPhone = target.querySelector(".overlay-image_broker-phone");
    setImgWithFallback(
      brokerPhone,
      absUrl(`assets/brokers/${brokerId}/broker-phone.png`),
      absUrl("assets/broker-phone.png")
    );
  }
}

// =====================
// Image handling
// =====================
function getImageDataUrl(inputId, maxW = 2200, maxH = 2200, quality = 0.9) {
  return new Promise((resolve) => {
    const input = document.getElementById(inputId);
    const file = input?.files?.[0];
    if (!file) return resolve('');

    if (file.size > 8 * 1024 * 1024) {
      alert("⚠️ Please upload an image under 8MB.");
      return resolve('');
    }
  </style>
</head>
<body>
  <form id="input-form" spellcheck="true" lang="en-GB">
    <label>Broker:
      <select id="broker">
        <option value="alex-krause" selected>Alex Krause</option>
        <option value="gary-brower">Gary Brower</option>
        <option value="bongane-khumalo">Bongane Khumalo</option>
        <option value="cliff-matshatsha">Cliff Matshatsha</option>
        <option value="daniel-wachenheimer">Daniel Wachenheimer</option>
        <option value="dean-doucha">Dean Doucha</option>
        <option value="elki-medalie">Elki Medalie</option>
        <option value="doron-sacks">Doron Sacks</option>
        <option value="george-merricks">George Merricks</option>
        <option value="gerhard-venter">Gerhard Venter</option>
        <option value="jenny-pillay">Jenny Pillay</option>
        <option value="jessica-beyers-lahner">Jessica Beyers-Lahner</option>
        <option value="jodi-bedil">Jodi Bedil</option>
        <option value="jodi-frankel">Jodi Frankel</option>
        <option value="keith-nkosi">Keith Nkosi</option>
        <option value="luanda-tlhotlhalemaje">Luanda Tlhotlhalemaje</option>
        <option value="nic-brett">Nic Brett</option>
        <option value="reece-louw">Reece Louw</option>
        <option value="reshma-sookran">Reshma Sookran</option>
        <option value="shlomo-hecht">Shlomo Hecht</option>
        <option value="sim-mthembu">Sim Mthembu</option>
        <option value="stuart-holliman">Stuart Holliman</option>
        <option value="thabani-ncube">Thabani Ncube</option>
        <option value="yoni-dadon">Yoni Dadon</option>
      </select>
    </label><br>

    <label>Headline: <textarea id="headline" rows="1" spellcheck="true">Lux 6-Bed Penthouse</textarea></label><br>
    <label>Subheadline: <textarea id="subheadline" rows="1" spellcheck="true">Lux 6-Bed</textarea></label><br>
    <label>Subheadline 2: <textarea id="subheadline2" rows="1" spellcheck="true">Penthouse</textarea></label><br>
    <label>City: <textarea id="city" rows="1" spellcheck="true">Cape Town</textarea></label><br>
    <label>Suburb: <textarea id="suburb" rows="1" spellcheck="true">Sandton</textarea></label><br>
    <label>Tagline 1: <textarea id="tag1" rows="1" spellcheck="true">Breathtaking</textarea></label><br>
    <label>Tagline 2: <textarea id="tag2" rows="1" spellcheck="true">Views</textarea></label><br>

    <label>Select Date: <input type="date" id="date-picker" value="2025-06-14"></label><br>

    <label>Select Time:
      <select id="time-picker">
        <option value="09:00">09:00</option>
        <option value="09:30">09:30</option>
        <option value="10:00">10:00</option>
        <option value="10:30" selected>10:30</option>
        <option value="11:00">11:00</option>
        <option value="11:30">11:30</option>
        <option value="12:00">12:00</option>
        <option value="12:30">12:30</option>
        <option value="14:00">14:00</option>
        <option value="14:30">14:30</option>
        <option value="18:00">18:00</option>
        <option value="18:30">18:30</option>
      </select>
    </label><br>

    <label>Address: <textarea id="address" rows="1" spellcheck="true">160 2nd Avenue, Edenvale</textarea></label><br>
    <label>Feature 1: <textarea id="feat1" rows="1" spellcheck="true">6 Bedrooms + 4 Bathrooms (main en-suite)</textarea></label><br>
    <label>Feature 2: <textarea id="feat2" rows="1" spellcheck="true">Home Office | Enclosed Entertainment Patio</textarea></label><br>
    <label>Feature 3: <textarea id="feat3" rows="1" spellcheck="true">Expansive Garden, Sparkling Pool + 2 Garages</textarea></label><br>

    <label>Upload Property Image: <input type="file" id="property-img"></label><br>
  </form>

  <!-- ✅ IMPORTANT: Make buttons type="button" so the form never submits/reloads -->
  <button type="button" onclick="downloadWordDoc()">Download Word Summary</button>

  <h2>Previews</h2>
  <div class="preview-panel">
    <div class="preview-block">
      <h3>Social Design</h3>
      <button type="button" onclick="generateAndDownload('social')">Download Social</button>
      <div id="social-preview" class="preview-box"></div>
    </div>

    <div class="preview-block">
      <h3>Newsletter Design</h3>
      <button type="button" onclick="generateAndDownload('newsletter')">Download Newsletter</button>
      <div id="newsletter-preview" class="preview-box"></div>
    </div>

    <div class="preview-block">
      <h3>Flyer Design</h3>
      <button type="button" onclick="generateAndDownload('flyer')">Download Flyer</button>
      <div id="flyer-preview" class="preview-box"></div>
    </div>
  </div>

  <script src="js/builder.js?v=2"></script>
</body>
</html>

  
